<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>

  <title>Stock Research || 1.1. 머신러닝을 위한 주가 데이터셋 생성</title>
  <meta name='description' content="1. baseline model1.1. 머신러닝을 위한 주가 데이터셋 생성주가 데이터셋 생성 절차는 df2list - dictionary - MultiProcessing - MySQL 순서로 진행한다. 4가지 절차를 통해 데이터셋이 달라지는 것은 아니고, 속도를 개선시키는 방향으로...">
  <link rel='canonical' href="https://ag-su.github.io/myblog/2022/07/06/stock-dataset/">
  <link rel='alternate' type='application/rss+xml' title='agsu BLOG' href="https://ag-su.github.io/myblog/feed.xml">
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Volkhov:400,700" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet">

  <style>
    
    @font-face{font-family:'Cafe24Oneprettynight';src:url("https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_twelve@1.1/Cafe24Oneprettynight.woff") format("woff");font-weight:normal;font-style:normal}/*! normalize.css v7.0.0 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:0.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace, monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace, monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}button,html [type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:0.35em 0.75em 0.625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px}[type="search"]::-webkit-search-cancel-button,[type="search"]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}template{display:none}[hidden]{display:none}body,h1,h2,h3,h4,h5,h6,p,blockquote,pre,dl,dd,ol,ul,fieldset,legend,figure,hr{margin:0;padding:0}li>ul,li>ol{margin-bottom:0}table{border-collapse:collapse;border-spacing:0}@-webkit-keyframes spin{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.icon{position:relative;display:inline-block;width:25px;height:25px;overflow:hidden;fill:currentColor}.icon__cnt{width:100%;height:100%;background:inherit;fill:inherit;pointer-events:none;transform:translateX(0);-ms-transform:translate(0.5px, -0.3px)}.icon--m{width:50px;height:50px}.icon--l{width:100px;height:100px}.icon--xl{width:150px;height:150px}.icon--xxl{width:200px;height:200px}.icon__spinner{position:absolute;top:0;left:0;width:100%;height:100%}.icon--ei-spinner .icon__spinner,.icon--ei-spinner-2 .icon__spinner{-webkit-animation:spin 1s steps(12) infinite;animation:spin 1s steps(12) infinite}.icon--ei-spinner-3 .icon__spinner{-webkit-animation:spin 1.5s linear infinite;animation:spin 1.5s linear infinite}.icon--ei-sc-facebook{fill:#3b5998}.icon--ei-sc-github{fill:#333}.icon--ei-sc-google-plus{fill:#dd4b39}.icon--ei-sc-instagram{fill:#3f729b}.icon--ei-sc-linkedin{fill:#0976b4}.icon--ei-sc-odnoklassniki{fill:#ed812b}.icon--ei-sc-skype{fill:#00aff0}.icon--ei-sc-soundcloud{fill:#f80}.icon--ei-sc-tumblr{fill:#35465c}.icon--ei-sc-twitter{fill:#55acee}.icon--ei-sc-vimeo{fill:#1ab7ea}.icon--ei-sc-vk{fill:#45668e}.icon--ei-sc-youtube{fill:#e52d27}.icon--ei-sc-pinterest{fill:#bd081c}.icon--ei-sc-telegram{fill:#0088cc}*,*::after,*::before{box-sizing:border-box}h1,h2,h3,h4,h5,h6,ul,ol,dl,blockquote,p,address,hr,table,fieldset,figure,pre{margin-bottom:15px}ul,ol,dd{margin-left:15px}@font-face{font-family:'D2 coding';src:url("http://cdn.jsdelivr.net/gh/joungkyun/font-d2coding/d2coding.css") format("text/css");font-weight:normal;font-style:normal}.highlight{background:#f0f0f082;font-family:'D2 coding'}.highlighter-rouge .highlight{background:#f0f0f082}.highlight .c{color:#998;font-style:italic}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .k{color:#29843b;font-weight:bold}.highlight .o{color:#c917ed;font-weight:bold}.highlight .cm{color:#998;font-style:italic}.highlight .cp{color:#999;font-weight:bold}.highlight .c1{color:#416373;font-style:italic}.highlight .cs{color:#999;font-weight:bold;font-style:italic}.highlight .gd{color:#000;background-color:#fdd}.highlight .gd .x{color:#000;background-color:#faa}.highlight .ge{font-style:italic}.highlight .gr{color:#a00}.highlight .gh{color:#999}.highlight .gi{color:#000;background-color:#dfd}.highlight .gi .x{color:#000;background-color:#afa}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:bold}.highlight .gu{color:#aaa}.highlight .gt{color:#a00}.highlight .kn{color:#29843b;font-weight:bold}.highlight .kc{font-weight:bold}.highlight .kd{font-weight:bold}.highlight .kp{font-weight:bold}.highlight .kr{font-weight:bold}.highlight .kt{color:#458;font-weight:bold}.highlight .m{color:#099}.highlight .s{color:#bc0202}.highlight .n{color:#000}.highlight .na{color:#008080}.highlight .nb{color:#29843b;font-weight:bold}.highlight .nc{color:#458;font-weight:bold}.highlight .no{color:#008080}.highlight .ni{color:#800080}.highlight .ne{color:#900;font-weight:bold}.highlight .nf{color:#150dff;font-weight:500}.highlight .nn{color:#555}.highlight .nt{color:#000080}.highlight .nv{color:#008080}.highlight .ow{font-weight:bold;color:#7590b7}.highlight .w{color:#bbb}.highlight .mf{color:#29843b;font-weight:bold}.highlight .mh{color:#099}.highlight .mi{color:#29843b;font-weight:bold}.highlight .mo{color:#099}.highlight .sa{color:#bc0202}.highlight .sb{color:#d14}.highlight .sc{color:#d14}.highlight .sd{color:#d14}.highlight .s2{color:#d14}.highlight .se{color:#d14}.highlight .sh{color:#d14}.highlight .si{color:#bc0202}.highlight .sx{color:#d14}.highlight .sr{color:#009926}.highlight .s1{color:#d14}.highlight .ss{color:#990073}.highlight .bp{color:#29843b;font-weight:bold}.highlight .vc{color:#008080}.highlight .vg{color:#008080}.highlight .vi{color:#008080}.highlight .il{color:#099}.highlight .p{color:#000}body{font-family:"Cafe24Oneprettynight";font-size:19px;line-height:28px;color:#404040;background-color:#fbfbfb;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}*::selection{color:#fff;background-color:#d86e89}h1,h2,h3,h4,h5,h6{font-family:"Cafe24Oneprettynight";font-weight:400;line-height:initial}h1{font-size:32px}h2{font-size:28px}h3{font-size:24px}h4{font-size:20px}h5{font-size:18px}h6{font-size:16px}img{max-width:100%;height:auto;vertical-align:middle}a{text-decoration:none;color:#3af;transition:.35s}a:hover{color:#0086e6}blockquote{padding-left:15px;border-left:3px solid #3af;font-family:'Volkhov', 'Times New Roman', Times, serif;font-style:normal;font-size:18px;background-color:rgba(220,235,245,0.2)}blockquote p{padding:10px}hr{height:1px;margin:30px 0;border:0;background-color:#f0f0f0}pre{overflow:auto;padding:25px;font-size:14px;white-space:pre-wrap;word-wrap:break-word;word-break:break-all;font-family:Courier, monospace}code{color:#928b8b;overflow:auto;white-space:pre-wrap;word-wrap:break-word;word-break:break-all;font-family:Courier, monospace;font-size:14px}p code,li code{padding:3px 5px}.o-wrapper{max-width:1440px;position:relative}.o-opacity{animation-duration:0.7s;animation-delay:0.2s;animation-fill-mode:both;animation-name:opacity}@keyframes opacity{from{opacity:0}to{opacity:1}}.c-btn{display:inline-block;white-space:nowrap;vertical-align:middle;font-family:'Volkhov', serif;font-size:12px;text-align:center;padding:8px 15px;cursor:pointer;transition:.35s}.c-btn--primary{color:#fff;background-color:#3af;background:linear-gradient(135deg, #3af 0%, #62d5ff 100%)}.c-btn--secondary{color:#fff;background-color:#cfcfdd;background:linear-gradient(135deg, #f1577d 0%, #cfcfdd 100%)}.c-btn--round{border-radius:30px}.c-btn--shadow{box-shadow:8px 10px 20px 0 rgba(46,61,73,0.15)}.c-btn--shadow:hover{box-shadow:2px 4px 8px 0px rgba(46,61,73,0.2)}.c-btn--middle{display:block;width:300px;max-width:100%}.c-btn--big{display:block;width:100%}.c-btn:hover{color:#fff;transition:.35s}.c-btn:active{transform:translateY(2px)}.c-sidebar{display:flex;flex-direction:column;justify-content:space-between;position:fixed;top:0;left:0;bottom:0;width:360px;padding:40px 20px 20px;text-align:center;box-shadow:1px 1px 0 rgba(31,35,46,0.15);background-color:#fff}.c-sidebar-author .c-author__cover{width:100px;height:100px;margin:0 auto 10px;border-radius:50%;overflow:hidden;background-color:#cfcfdd;font-family:'Cafe24Oneprettynight'}.c-sidebar-author .c-author__cover img{width:100%;height:100%;border-radius:50%;transition:.35s}.c-sidebar-author .c-author__cover img:hover{transform:scale3d(0.9, 0.9, 1)}.c-sidebar-author .c-contact-menu .c-btn{min-width:110px}.c-sidebar-author .c-contact-menu .c-btn .icon{width:18px;height:18px;vertical-align:text-bottom;fill:#fff}.c-sidebar-author .c-author__info{font-family:"Cafe24Oneprettynight"}.c-sidebar-author .c-author__name{font-size:18px;font-weight:700;line-height:21px}.c-sidebar-author .c-author__job{font-size:12px;color:#a0a0a0;margin:5px 0 0}.c-sidebar-author .c-contact-menu{margin:30px 0}.c-sidebar-author .c-contact-menu .c-btn--secondary{margin-right:10px}.c-sidebar-author .c-author__about{max-width:400px;margin:0 auto 15px;font-size:13px}.c-sidebar-footer .c-social__title{position:relative;font-family:'Volkhov', serif;font-size:15px;font-weight:700;color:#444}.c-sidebar-footer .c-social__title::before{content:"";display:block;height:2px;width:calc(50% - 40px);transform:translateY(-50%);position:absolute;top:50%;left:0;background-color:#444}.c-sidebar-footer .c-social__title::after{content:"";display:block;height:2px;width:calc(50% - 40px);transform:translateY(-50%);position:absolute;top:50%;right:0;background-color:#444}.c-sidebar-footer .c-social__list{list-style-type:none;padding:0;margin:15px 0}.c-sidebar-footer .c-social__list .c-social__item{display:inline-block;width:27px;height:27px}.c-sidebar-footer .c-social__list .icon{width:27px;height:27px;fill:#444;vertical-align:middle;transition:.35s}.c-sidebar-footer .c-social__list .icon:hover{fill:#3af;transform:scale(1.2);transition:.35s}.c-sidebar-footer .c-copyright p{font-size:13px;margin:0}@media only screen and (max-width: 900px){.c-sidebar{position:relative;width:100%;padding:20px}.c-sidebar .c-contact-menu{margin:20px 0}.c-sidebar-footer .c-social .c-social__title{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px;word-wrap:normal !important}.c-sidebar-footer .c-social__list{margin:0}.c-sidebar-footer .c-copyright{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px;word-wrap:normal !important}}@media only screen and (max-width: 480px){.c-sidebar-author .c-author__cover{width:80px;height:80px}.c-sidebar-author .c-author__cover img{width:100%;height:100%}.c-sidebar-author .c-contact-menu{margin:15px 0}.c-sidebar-author .c-contact-menu .c-btn{min-width:80px;font-size:10px;padding:4px 15px;margin-right:5px}.c-sidebar-author .c-contact-menu .c-btn .icon{width:16px;height:16px}.c-sidebar-footer .c-social .c-social__title{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px;word-wrap:normal !important}.c-sidebar-footer .c-social__list{margin:0}.c-sidebar-footer .c-social__list .icon{width:25px;height:25px}.c-sidebar-footer .c-copyright{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px;word-wrap:normal !important}}.c-content{position:relative;display:flex;flex-direction:row;flex-wrap:wrap;align-items:stretch;padding:0 20px 0;margin-left:360px}@media only screen and (max-width: 900px){.c-content{position:static;padding:0 15px 0;margin-left:0}}.c-posts{width:100%;display:flex;flex-direction:row;flex-wrap:wrap}.c-post{width:100%;max-width:100%;margin-bottom:20px;display:flex;flex-direction:row;align-items:stretch;min-height:180px;border-radius:10px;overflow:hidden;transition:.35s;background-color:#fff;box-shadow:0 1px 1px 0 rgba(31,35,46,0.15)}.c-post:hover{transform:translate(0px, -2px);box-shadow:0 15px 45px -10px rgba(10,16,34,0.2)}.c-post .c-post-thumbnail{display:block;width:30%;max-width:100%;min-height:180px;border-radius:10px 0 0 10px;background-color:rgba(220,235,245,0.2);background-size:cover;background-position:50% 50%}.c-post .c-post-content{padding:15px;width:70%}.c-post .c-post-content .c-post-title{font-size:30px;font-weight:400;margin:0 0 15px}.c-post .c-post-content .c-post-title a{text-decoration:none;color:#263959}.c-post .c-post-content .c-post-date,.c-post .c-post-content .c-post-words{font-size:12px}.c-load-more{padding:20px;margin:20px auto 40px;font-size:13px;color:#fff;border:none;background-color:#d0a9ae;outline:none}.c-load-more:hover{background-color:#0086e6}@media only screen and (max-width: 1200px){.c-post{width:48%;max-width:100%;margin:0 1% 20px;flex-direction:column}.c-post .c-post-thumbnail{width:100%;border-radius:10px 10px 0 0}.c-post .c-post-content{width:100%}.c-post .c-post-content .c-post-title{font-size:21px;margin:15px 0}}@media only screen and (max-width: 480px){.c-post{width:100%;max-width:100%;margin:0 0 20px}.c-post .c-post-content{width:100%}.c-post .c-post-content .c-post-title{font-size:21px;margin:15px 0}}.c-article{width:100%;margin:20px 0}.c-wrap-content{padding:20px;background-color:#fff}.c-article__image{position:relative;background-color:rgba(220,235,245,0.2);background-position:center;background-size:cover;background-repeat:no-repeat}.c-article__image:after{content:"";display:block;padding-top:56%}.c-article__header{margin-bottom:20px;text-align:center}.c-article__header .c-article__title{margin-bottom:10px}.c-article__date span{font-size:13px;text-transform:uppercase;color:#a0a0a0}.c-article__footer{margin:30px 0 0;padding-bottom:30px;text-align:center;border-bottom:1px solid #f0f0f0}.c-article__footer .c-article__share{transition:.35s}.c-article__footer .c-article__share a .icon{vertical-align:middle;transition:.35s}.c-article__footer .c-article__share a .icon:hover{opacity:.7;transition:.35s}.c-article__footer .c-article__tag{margin-bottom:5px}.c-article__footer .c-article__tag a{display:inline-block;vertical-align:middle;padding:5px 10px;font-family:'Volkhov', 'Times New Roman', Times, serif;font-size:10px;line-height:10px;text-transform:uppercase;background-color:rgba(115,138,160,0.6);color:#fff}.c-article__footer .c-article__tag a:hover{background-color:rgba(80,100,118,0.6)}.c-article__footer .c-article__tag a:last-child{margin-right:0}.c-recent-post{padding:30px 0}.c-recent-post .c-recent__title{font-size:14px;text-align:center;text-transform:uppercase;margin-bottom:30px}.c-recent-post .c-recent__box{display:flex;flex-direction:row;flex-wrap:wrap}.c-recent-post .c-recent__item{max-width:23%;flex-basis:23%;margin:0 1% 20px;border-radius:10px;overflow:hidden;text-align:center;background-color:#fff;box-shadow:0 1px 1px 0 rgba(31,35,46,0.15);transition:.35s}.c-recent-post .c-recent__item h4{margin-bottom:5px;font-size:12px;text-transform:uppercase}.c-recent-post .c-recent__item h4 a{color:#444}.c-recent-post .c-recent__item:hover{box-shadow:2px 4px 8px 0px rgba(46,61,73,0.2)}.c-recent-post .c-recent__footer{padding:15px}.c-recent-post .c-recent__image{display:block;width:100%;min-height:180px;background-color:rgba(220,235,245,0.2);background-size:cover;background-position:center;background-repeat:no-repeat}.c-recent-post .c-recent__date{color:#a0a0a0;font-size:12px}@media only screen and (max-width: 1200px){.c-recent-post .c-recent__item{max-width:48%;flex-basis:48%}}@media only screen and (max-width: 900px){.c-article{margin:15px 0}}@media only screen and (max-width: 480px){.c-wrap-content{padding:15px}.c-article__header{margin-bottom:5px}.c-article__header .c-article__title{font-size:24px;margin-bottom:5px}.c-recent-post .c-recent__item{max-width:100%;flex-basis:100%;margin:0 0 20px}}.c-blog-tags{width:100%;padding:20px;margin:20px 0 40px;background-color:#fff}.c-blog-tags h1{text-align:center;margin-bottom:0}.c-blog-tags h2{font-size:18px;text-transform:uppercase;margin:30px 0;color:#757575}.c-tag__list{list-style:none;padding:0 0 40px;margin:40px 0 0;border-bottom:1px solid #f0f0f0}.c-tag__list li{display:inline-block;margin-right:15px}.c-tag__list li a{color:#404040;text-transform:uppercase;font-size:12px}.c-tag__list li a:hover{color:#000}.c-tag__item{margin-bottom:15px}.c-tag__image{width:50px;height:50px;border-radius:50%;margin-right:5px}@media only screen and (max-width: 480px){.c-blog-tags{padding:15px}.c-blog-tags h1{font-size:27px}.c-blog-tags h2{font-size:16px;margin:15px 0}.c-tag__list{padding:0 0 30px;margin:30px 0 0}.c-tag__item{margin-bottom:5px}.c-tag__image{display:none}}.c-header{position:relative;width:100%;margin:20px 0}.c-header__box{position:relative;display:flex;flex-direction:row;justify-content:space-between;align-items:center}.c-header__box .icon--ei-search{position:absolute;top:7px;left:15px;fill:#ccc}.c-search{width:80%}.c-search .c-search__box{display:flex;align-items:center}.c-search .c-search__text{position:relative;width:100%;padding:10px 10px 10px 40px;border:1px solid #dce4ea;border-radius:30px;outline:none;color:#a0a0a0}.c-search .c-search__text::placeholder{color:#ccc}.c-search .c-search__text:hover{box-shadow:0 1px 0px rgba(132,135,138,0.1);transition:.35s}.c-search .c-search-results-list{position:absolute;width:100%;margin:10px 0 0;list-style-type:none;background-color:#fff;z-index:1}.c-search .c-search-results-list li{display:flex;flex-wrap:wrap;align-items:center;margin:0;padding:20px 25px 0;background-color:#fff;line-height:1.4;border-left:solid 1px #edeeee;border-right:solid 1px #edeeee}.c-search .c-search-results-list li:first-child{border-top-left-radius:5px;border-top-right-radius:5px;border-top:solid 1px #edeeee}.c-search .c-search-results-list li:last-child{border-bottom-left-radius:5px;border-bottom-right-radius:5px;padding-bottom:25px;border-bottom:solid 1px #edeeee}.c-search .c-search-results-list li a{font-size:16px}.c-nav{flex-grow:1;padding-left:20px}.c-nav .c-nav__list{display:flex;justify-content:flex-end}.c-nav .c-nav__list .c-nav__item{display:flex;align-items:center;float:left;padding:4px 10px;font-size:10px;text-transform:uppercase;white-space:nowrap;border:1px solid #dce4ea;box-shadow:0 1px 0px rgba(132,135,138,0.4);will-change:transform;transform:translateY(0px);cursor:pointer}.c-nav .c-nav__list .c-nav__item:hover{color:#222;background-color:#fff}.c-nav .c-nav__list .c-nav__item.is-active{box-shadow:0 0 0 rgba(132,135,138,0.5);transform:translateY(1px);color:#cfcfdd}.c-nav .c-nav__list .c-nav__item.is-active:hover{background-color:#fbfbfb}.c-nav .c-nav__list .c-nav__item:first-child{border-radius:10px 0 0 10px}.c-nav .c-nav__list .c-nav__item:last-child{border-radius:0 10px 10px 0}.c-nav .c-nav__list .c-nav__item .icon{width:18px;height:18px;margin-right:3px}@media only screen and (max-width: 900px){.c-header{margin:15px 0}}@media only screen and (max-width: 480px){.c-header .c-header__box{flex-direction:column}.c-header .c-search{width:100%}.c-header .c-search .c-search__text{padding:8px 8px 8px 40px}.c-header .c-nav{margin-top:15px}.c-header .c-nav .c-nav__list{justify-content:center}.c-header .c-nav .c-nav__item{padding:4px 8px}}.c-categories{width:100%}.c-categories__list{width:100%;display:flex;flex-direction:row;flex-wrap:wrap}.c-categories__item{max-width:25%;flex-basis:25%;padding:0 10px 20px}.c-categories__link{height:100%;display:flex;flex-direction:column;align-items:center;padding:20px 10px;border-radius:5px;box-shadow:5px 5px 25px rgba(46,61,73,0.15);background-color:#fff;transition:.35s}.c-categories__link:hover{box-shadow:2px 4px 8px 0px rgba(46,61,73,0.2)}.c-categories__link:hover .c-categories__img .c-categories__more{opacity:1;transition:.35s}.c-categories__link .c-categories__container{width:100%;word-wrap:break-word}.c-categories__link .c-categories__container.c-empty-figure{display:flex;flex-direction:column;justify-content:center;flex-grow:1}.c-categories__img{position:relative;max-width:100%}.c-categories__img figure{position:relative;width:200px;max-width:100%;margin-bottom:20px;overflow:hidden;background-size:cover;background-repeat:no-repeat;background-position:center;border-radius:50%;box-shadow:inset 0 1px 3px rgba(141,165,185,0.3)}.c-categories__img figure:after{content:"";display:block;padding-top:100%}.c-categories__img figure:before{content:"";position:absolute;top:0;bottom:0;left:0;right:0;background-color:rgba(0,0,0,0.15)}.c-categories__img .c-categories__more{display:inline-block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);font-weight:700;color:#fff;text-transform:uppercase;text-shadow:0 1px 0 rgba(104,172,191,0.3);opacity:0;transition:.35s}.c-categories__container{text-align:center}.c-categories__container .c-categories__header{font-size:13px;margin-bottom:10px;font-weight:normal;text-transform:uppercase;color:#404040}.c-categories__container .c-categories__count{font-family:'Volkhov', serif;font-size:12px;color:#404040;margin-bottom:0}.c-categories__container .c-categories__count span{display:inline-block;width:20px;height:20px;line-height:20px;vertical-align:baseline;margin-right:5px;border-radius:50%;color:#fff;background-color:#ee6c6c}@media only screen and (max-width: 1200px){.c-categories .c-categories__item{max-width:33.333%;flex-basis:33.333%}}@media only screen and (max-width: 1050px){.c-categories .c-categories__item{max-width:50%;flex-basis:50%}}@media only screen and (max-width: 480px){.c-categories .c-categories__item{max-width:100%;flex-basis:100%;padding:0 0 20px}}.c-form-box{position:absolute;top:0;width:calc(100% - 40px);min-height:100vh;padding:0 20px;background-color:#fff;z-index:1}.c-form-bnt__close{position:absolute;top:0px;left:0;width:30px;height:30px;cursor:pointer;transition:.35s}.c-form-bnt__close:hover{transform:scale(0.8);opacity:.8}.c-form{position:relative;width:750px;max-width:100%;margin:40px auto}.c-form .c-form__title{margin:0 0 40px;min-width:0;border:0;padding:0;font-family:"Cafe24Oneprettynight";text-transform:uppercase;text-align:center}.c-form a{color:#404040}.c-form__group{margin-bottom:20px}.c-form__group label{display:block;text-transform:uppercase;font-size:10px}.c-form__group input,.c-form__group textarea{width:100%;padding:10px 15px;color:#404040;border:1px solid #dce4ea;outline:none;transition:.35s}.c-form__group input:focus,.c-form__group textarea:focus{box-shadow:0 4px 25px rgba(132,135,138,0.1)}.c-form__group button{padding:20px;text-transform:uppercase;outline:none;border:none}.c-thank-you p{position:relative;padding:20px 40px;width:750px;max-width:100%;text-transform:uppercase;font-size:12px;line-height:18px;font-weight:700;margin:40px auto 0;text-align:center;color:#fff;background:linear-gradient(135deg, #55b5ad 0%, #5ec9c5 100%)}.c-thank-you p .c-form-bnt__close{width:25px;height:25px;background:transparent}.c-thank-you p a{color:#fff}@media only screen and (max-width: 900px){.c-form-box{width:100%;left:0;right:0}}@media only screen and (max-width: 480px){.c-form-bnt__close{width:25px;height:25px}}.c-newsletter{padding:30px 0 60px;margin:0 auto;border-bottom:1px solid #f0f0f0}.c-newsletter__header{text-align:center}.c-newsletter__header .c-newsletter__title{font-size:14px;text-transform:uppercase;text-align:center}.c-newsletter__header .c-newsletter__subtitle{margin-bottom:15px}.c-newsletter-form{width:100%;max-width:750px;margin:0 auto}.c-newsletter-form .c-newsletter-form__group{display:flex}.c-newsletter__email{width:70%;height:40px;padding:10px 15px;border:1px solid #ddd;border-right-color:transparent;outline:none;transition:.35s}.c-newsletter__email:focus{box-shadow:0 4px 25px rgba(132,135,138,0.1)}.c-newsletter__button{width:30%;height:40px;color:#fff;background-color:#3af;transition:.35s;border:none;outline:none;cursor:pointer}.c-newsletter__button:hover{background-color:#0086e6}@media only screen and (max-width: 480px){.c-newsletter__button{font-size:13px}}.c-comments{padding:30px 0;border-top:1px solid #f0f0f0}.c-top{position:fixed;width:40px;height:40px;bottom:20px;color:#757575;cursor:pointer;transition:.35s;right:-100px;z-index:10;opacity:.5}.c-top--active{right:15px}.c-top:hover{color:#757575;opacity:1}.u-text-left{text-align:left}.u-text-right{text-align:right}.u-text-center{text-align:center}.u-text-justify{text-align:justify}.u-block{display:block}.u-inline-block{display:inline-block}.u-inline{display:inline}.u-full-width{display:block;width:100%}.u-vertical-center{display:flex;align-items:center;justify-content:center}.u-responsive-image{max-width:100%;height:auto;vertical-align:middle}.u-show{display:block !important}.u-hide{display:none !important}.u-invisible{visibility:hidden}.u-float-left{float:left}.u-float-right{float:right}.u-no-padding-top{padding-top:0}.u-no-padding-bottom{padding-bottom:0}.u-no-padding-left{padding-left:0}.u-no-padding-right{padding-right:0}.u-no-padding{padding:0}.u-no-margin-top{margin-top:0}.u-no-margin-bottom{margin-bottom:0}.u-no-margin-left{margin-left:0}.u-no-margin-right{margin-right:0}.u-no-margin{margin:0}.u-lists-reset{list-style-type:none;margin:0;padding:0}.u-clearfix::before,.u-clearfix::after{content:"";display:table;clear:both}.u-screen-reader-text{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px;word-wrap:normal !important}

  </style>
</head>

<body>
  
  <div class="o-wrapper">
    <aside class="c-sidebar">
  <div class="c-sidebar-author">
    <div class="c-author__cover">
      <a href="/myblog/">
        <img src="/myblog/images/jjang.png" alt="agsu">
      </a>
    </div>
    <div class="c-author__info">
      <div class="c-author__name">agsu</div>
      <span class="c-author__job">Department of Data Science</span>
    </div>
    <div class="c-contact-menu">
      
      <a href="/contact" class="c-contact-btn c-btn c-btn--secondary c-btn--round c-btn--shadow"><span data-icon='ei-envelope' data-size='s'></span> Send me</a>
      
      
      
    </div>
    <p class="c-author__about">블로그</p>
  </div>

  <div class="c-sidebar-footer">
    <div class="c-social">
      <div class="c-social__title">Social</div>
      <ul class="c-social__list u-lists-reset">
        
        
        
        
        
          <li class="c-social__item"><a href="https://github.com/artemsheludko" target="_blank"><div data-icon='ei-sc-github' data-size='s'></div></a></li>
        
        
        
        
          <li class="c-social__item"><a href="https://instagram.com/artemsheludko_" target="_blank"><div data-icon='ei-sc-instagram' data-size='s'></div></a></li>
        
        
        
        
        
        
        
      </ul>
    </div>
    <div class="c-copyright">
      <p>2022 &copy; agsu</p>
    </div>
  </div>
</aside> <!-- /.c-sidebar -->

<main class="c-content">
  <article class="c-article">
  <div class="c-article__content">
    <header class="c-header u-hide u-no-margin-top">
      <div class="c-header__box">
        <div class="c-search u-full-width">
          <div class="c-search__box">
            <label for="js-search-input" class="u-screen-reader-text">Search for Blog</label>
            <input type="text" id="js-search-input" class="c-search__text" autocomplete="off" placeholder="Type to search...">
            <div data-icon='ei-search' data-size='s'></div>
          </div>
          <ul id="js-results-container" class="c-search-results-list"></ul>
        </div>
      </div>
    </header>
    
    <div class="c-article__image o-opacity" style="background-image: url( /myblog/images/01.thumbnail.png )"></div>
    
    <div class="c-wrap-content">
      <header class="c-article__header">
        <h1 class="c-article__title">Stock Research || 1.1. 머신러닝을 위한 주가 데이터셋 생성</h1>
        <div class="c-article__date">
          <span>2022, Jul 06</span>
        </div>
      </header>
      <h1 id="1-baseline-model">1. baseline model</h1>
<h2 id="11-머신러닝을-위한-주가-데이터셋-생성">1.1. 머신러닝을 위한 주가 데이터셋 생성</h2>
<p>주가 데이터셋 생성 절차는 <code class="language-plaintext highlighter-rouge">df2list</code> - <code class="language-plaintext highlighter-rouge">dictionary</code> - <code class="language-plaintext highlighter-rouge">MultiProcessing</code> - <code class="language-plaintext highlighter-rouge">MySQL</code> 순서로 진행한다. 4가지 절차를 통해 데이터셋이 달라지는 것은 아니고, 속도를 개선시키는 방향으로의 효율적인 코드를 짜기 위한 훈련 과정이다. 대규모 데이터셋을 다루기 위해서는 효율적인 코딩을 통해 속도를 개선하는 것도 중요한 일이다. 특히 이번에 사용하는 주가 데이터셋은 양이 많을 뿐만 아니라, <code class="language-plaintext highlighter-rouge">fdr</code> 라이브러리를 사용하여 외부에서 불러와야하기 때문에 데이터셋을 구성하는 것만 해도 속도가 상당히 느리다. 이러한 문제점을 해결하고자 본 포스팅에서는 4단계에 걸친 데이터셋 생성 과정을 보여준다.</p>

<p><br /></p>

<h3 id="데이터셋-정의">데이터셋 정의</h3>
<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">조건</code></strong>: 전체 약 2000개 종목 중 2018년 부터 존속하였던 기업 중 거래대금이 1000억 이상 발생한 날짜 (거래대금은 추후에 수정 가능)</li>
  <li><strong><code class="language-plaintext highlighter-rouge">column</code></strong>: <strong><code class="language-plaintext highlighter-rouge">조건</code></strong> 에서 선별한 특정 날짜를 D0라고 했을 때, D-9, D-8, …, D0, 총 10일 치의 <code class="language-plaintext highlighter-rouge">Open</code>, <code class="language-plaintext highlighter-rouge">High</code>, <code class="language-plaintext highlighter-rouge">Low</code>, <code class="language-plaintext highlighter-rouge">Close</code>, <code class="language-plaintext highlighter-rouge">거래대금(trading_value)</code></li>
  <li><strong><code class="language-plaintext highlighter-rouge">label</code></strong>:  조건에 부합하는 특정 날짜(D0) 대비 다음날(D+1) 날짜의 종가(close)가 2%이상 상승하면 <code class="language-plaintext highlighter-rouge">1</code>, 상승하지 않으면 <code class="language-plaintext highlighter-rouge">0</code></li>
  <li><strong><code class="language-plaintext highlighter-rouge">train dataset</code></strong>: 2018년 1월 2일 - 2020년 12월 31일 (2년)</li>
  <li><strong><code class="language-plaintext highlighter-rouge">test dataset</code></strong>: 2021년 1월 2일 ~ 2021년 6월 31일 (6개월)</li>
</ul>

<p><br /></p>

<h3 id="데이터셋-생성-과제">데이터셋 생성 과제</h3>
<p>데이터셋 생성을 총 3가지 과제로 나누어 진행한다.</p>
<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">과제 I</code></strong>: 종목 리스트 생성-2018년 부터 존속하였던 기업(상장일 2018년 1월 1일 이전 기업)  선별</li>
  <li><strong><code class="language-plaintext highlighter-rouge">과제 II</code></strong>: <strong><code class="language-plaintext highlighter-rouge">과제I</code></strong> 의 기업 중 거래대금이 1000억 이상 발생했던 특정 날짜 선별 (<code class="language-plaintext highlighter-rouge">거래대금</code>=<code class="language-plaintext highlighter-rouge">거래량</code>X<code class="language-plaintext highlighter-rouge">종가</code> 로 계산)</li>
  <li><strong><code class="language-plaintext highlighter-rouge">과제 III</code></strong>: <strong><code class="language-plaintext highlighter-rouge">과제II</code></strong> 의 날짜에 대해 최종 머신러닝 데이터 생성</li>
</ul>

<p><br /></p>

<h3 id="목차">목차</h3>
<ul>
  <li><strong>(0)</strong> Finance Data Reader를 이용한 주가 데이터셋 - <code class="language-plaintext highlighter-rouge">DataFrame</code></li>
  <li><strong>(1)</strong> Finance Data Reader를 이용한 주가 데이터셋 - <code class="language-plaintext highlighter-rouge">df2list</code></li>
  <li><strong>(2)</strong> Finance Data Reader를 이용한 주가 데이터셋 - <code class="language-plaintext highlighter-rouge">dictionary</code></li>
  <li><strong>(3)</strong> Finance Data Reader를 이용한 주가 데이터셋 - <code class="language-plaintext highlighter-rouge">MultiProcessing</code></li>
  <li><strong>(4)</strong> Finance Data Reader를 이용한 주가 데이터셋 - <code class="language-plaintext highlighter-rouge">MySQL</code></li>
  <li><strong>(5)</strong> 최종 머신러닝 데이터셋</li>
</ul>

<h3 id="필요-라이브러리-import">필요 라이브러리 <strong>import</strong></h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># finance datareader 설치 
# ! pip install -U finance-datareader
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">FinanceDataReader</span> <span class="k">as</span> <span class="n">fdr</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># 경고 메시지 무시 
</span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="p">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s">'ignore'</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="️-0-finance-data-reader를-이용한-주가-데이터셋---dataframe">✔️ <strong>(0)</strong> Finance Data Reader를 이용한 주가 데이터셋 - <code class="language-plaintext highlighter-rouge">DataFrame</code></h2>
<p>속도 비교를 위해 기존 데이터의 타입인 <code class="language-plaintext highlighter-rouge">DataFrame</code>을 사용하여 데이터셋을 생성한다.</p>

<p><strong>과제 I</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_html</span><span class="p">(</span><span class="s">'http://kind.krx.co.kr/corpgeneral/corpList.do?method=download'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># 회사명, 종목코드, 상장일 컬럼만 사용 
</span><span class="n">df_code</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s">'회사명'</span><span class="p">,</span> <span class="s">'종목코드'</span><span class="p">,</span> <span class="s">'상장일'</span><span class="p">]]</span>

<span class="c1"># 종목코드를 6자리로 맞춰 준다. 
</span><span class="n">df_code</span><span class="p">[</span><span class="s">'종목코드'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_code</span><span class="p">[</span><span class="s">'종목코드'</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">).</span><span class="n">zfill</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_code</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="k">print</span><span class="p">()</span>

<span class="c1"># 상장일이 2018년 1월 1일 이전인 종목코드 선별 
</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">lst_code</span> <span class="o">=</span> <span class="n">df_code</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_code</span><span class="p">[</span><span class="s">'상장일'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s">'2018-01-01'</span><span class="p">,</span> <span class="s">'종목코드'</span><span class="p">].</span><span class="n">to_list</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">"걸린 시간: "</span><span class="p">,</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
<span class="k">print</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">'상장일 2018-01-01 이전 종목코드: '</span><span class="p">,</span> <span class="n">lst_code</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="k">print</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'총 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_code</span><span class="p">)</span><span class="si">}</span><span class="s"> 개의 종목 중 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_code</span><span class="p">)</span><span class="si">}</span><span class="s"> 개의 종목 선별'</span><span class="p">)</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>회사명</th>
      <th>종목코드</th>
      <th>상장일</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>DL</td>
      <td>000210</td>
      <td>1976-02-02</td>
    </tr>
    <tr>
      <th>1</th>
      <td>DRB동일</td>
      <td>004840</td>
      <td>1976-05-21</td>
    </tr>
    <tr>
      <th>2</th>
      <td>DSR</td>
      <td>155660</td>
      <td>2013-05-15</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>걸린 시간:  0.0006058216094970703

상장일 2018-01-01 이전 종목코드:  ['000210', '004840', '155660', '078930', '001390']

총 2536 개의 종목 중 1972 개의 종목 선별
</code></pre></div></div>

<p><strong>과제 II</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stock_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">lst_code</span><span class="p">):</span> 
    <span class="n">stock</span> <span class="o">=</span> <span class="n">fdr</span><span class="p">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s">'20180101'</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">'20201231'</span><span class="p">)</span>
    <span class="n">stock</span><span class="p">[</span><span class="s">'trading'</span><span class="p">]</span> <span class="o">=</span> <span class="n">stock</span><span class="p">[</span><span class="s">'Volume'</span><span class="p">]</span> <span class="o">*</span> <span class="n">stock</span><span class="p">[</span><span class="s">'Close'</span><span class="p">]</span> <span class="c1"># 거래대금 컬럼 추가
</span>    
    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">stock</span><span class="p">[</span><span class="s">'trading'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">100000000000</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># 거래대금이 1000억 이상인 데이터가 하나 이상 존재하면
</span>        <span class="n">stock_dict</span><span class="p">[</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">stock</span><span class="p">[</span><span class="n">stock</span><span class="p">[</span><span class="s">'trading'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">100000000000</span><span class="p">].</span><span class="n">index</span> 

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'총 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_code</span><span class="p">)</span><span class="si">}</span><span class="s"> 개의 종목 중 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">stock_dict</span><span class="p">)</span><span class="si">}</span><span class="s"> 개의 종목 사용'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>100%|██████████████████████████████████████████████| 1977/1977 [02:58&lt;00:00, 11.08it/s]

총 1977 개의 종목 중 799 개의 종목 사용
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 선별된 종목과 날짜를 lst_code_date에 넣어준다. 
</span><span class="n">lst_code_date</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">stock_dict</span><span class="p">):</span> 
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="p">(</span><span class="n">stock_dict</span><span class="p">[</span><span class="n">code</span><span class="p">]):</span>
        <span class="n">lst_code_date</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="n">code</span><span class="p">,</span> <span class="n">date</span><span class="p">])</span>
        
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'선별된 날짜는 총 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_code_date</span><span class="p">)</span><span class="si">}</span><span class="s">개'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>100%|█████████████████████████████████████████████| 799/799 [00:00&lt;00:00, 13125.89it/s]

선별된 날짜는 총 14182개
</code></pre></div></div>

<p><strong>과제 III</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">'code'</span><span class="p">:</span> <span class="p">[],</span> <span class="s">'d0'</span><span class="p">:</span> <span class="p">[],</span> <span class="s">'info'</span><span class="p">:</span> <span class="p">[],</span> <span class="s">'up'</span><span class="p">:</span> <span class="p">[]}</span>
<span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">lst_code_date</span><span class="p">):</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="s">'20171201'</span> <span class="c1"># 2018년 초반 날짜가 D0라면 2017년 데이터 필요 (D-9~D-1)
</span>    <span class="n">end_date</span> <span class="o">=</span> <span class="s">'20210130'</span> <span class="c1"># 2020년 후반 날짜가 D0라면 2021년 데이터 필요 (D+1) 
</span>    <span class="n">stock</span> <span class="o">=</span> <span class="n">fdr</span><span class="p">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">end_date</span><span class="p">)</span>
    <span class="n">stock</span><span class="p">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># 'Date' index -&gt; column 
</span>    
    <span class="n">D9_index</span> <span class="o">=</span> <span class="n">stock</span><span class="p">[</span><span class="n">stock</span><span class="p">[</span><span class="s">'Date'</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">date</span><span class="p">)].</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">9</span> <span class="c1"># D-9 날짜의 인덱스  
</span>    <span class="n">next_index</span> <span class="o">=</span> <span class="n">stock</span><span class="p">[</span><span class="n">stock</span><span class="p">[</span><span class="s">'Date'</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">date</span><span class="p">)].</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># D+1 날짜의 인덱스  
</span>        
    <span class="c1"># 종목코드 (code)
</span>    <span class="n">data_dict</span><span class="p">[</span><span class="s">'code'</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> 
    
    <span class="c1"># 기준일 (d0)
</span>    <span class="n">data_dict</span><span class="p">[</span><span class="s">'d0'</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
    
    <span class="c1"># D-9 ~ D+1, 총 11일치의 sub stock DataFrame 생성 
</span>    <span class="n">sub_stock</span> <span class="o">=</span> <span class="n">stock</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">D9_index</span><span class="p">:</span><span class="n">next_index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">sub_stock</span><span class="p">[</span><span class="s">'trading'</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub_stock</span><span class="p">[</span><span class="s">'Close'</span><span class="p">]</span> <span class="o">*</span> <span class="n">sub_stock</span><span class="p">[</span><span class="s">'Volume'</span><span class="p">]</span> <span class="c1"># 거래대금 컬럼 추가 
</span>   
    
    <span class="c1"># 10일 간의 데이터 (info)
</span>    <span class="n">info_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>        
        <span class="n">info_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_stock</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]].</span><span class="n">to_list</span><span class="p">())</span>
    <span class="n">remove_list</span><span class="o">=</span><span class="p">[</span><span class="s">'['</span><span class="p">,</span> <span class="s">']'</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span> 
        <span class="n">info_list</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">info_list</span><span class="si">}</span><span class="s">'</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="n">remove_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s">''</span><span class="p">)</span>
    <span class="n">data_dict</span><span class="p">[</span><span class="s">'info'</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">info_list</span><span class="p">)</span>    
        
        
    <span class="c1"># D+1 종가 2% 상승 여부 (up)
</span>    <span class="n">up</span> <span class="o">=</span> <span class="n">sub_stock</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="s">'Close'</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.02</span> <span class="o">*</span> <span class="n">sub_stock</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="s">'Close'</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">sub_stock</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">'Close'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">up</span><span class="p">:</span> 
        <span class="n">data_dict</span><span class="p">[</span><span class="s">'up'</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">data_dict</span><span class="p">[</span><span class="s">'up'</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>100%|████████████████████████████████████████████| 14182/14182 [17:08&lt;00:00, 13.78it/s]
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_result</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_result</span><span class="p">.</span><span class="n">head</span><span class="p">())</span> 

<span class="c1"># 최종 결과 데이터셋 txt 파일 저장 
</span><span class="n">df_result</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">"assignment3.txt"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'생성된 데이터의 개수는 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"assignment3.txt"</span><span class="p">))</span><span class="si">}</span><span class="s"> 개'</span><span class="p">)</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>d0</th>
      <th>info</th>
      <th>up</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>000210</td>
      <td>2018-01-26</td>
      <td>78343, 78614, 76987, 77892, 9590608284, 77801,...</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>000210</td>
      <td>2018-08-08</td>
      <td>68855, 69397, 67590, 69036, 6067435968, 69487,...</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>000210</td>
      <td>2020-04-02</td>
      <td>44819, 52951, 44322, 51145, 15615437965, 47439...</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>000210</td>
      <td>2020-09-11</td>
      <td>80783, 84487, 78524, 78524, 61554885076, 79608...</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>000210</td>
      <td>2020-12-11</td>
      <td>76174, 76174, 72289, 72289, 76043112348, 72831...</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>생성된 데이터의 개수는 14182 개
</code></pre></div></div>

<p><strong>개선해야할 사항</strong></p>
<ul>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">속도 개선</code></strong>: <strong><code class="language-plaintext highlighter-rouge">과제III</code></strong> 은 약 17분이 걸린 것을 보아 속도 면에서 상당히 비효율적이었다는 것을 알 수 있다. (거래대금을 10억으로 설정했을 때 1% 진행에 5분이 걸렸다. 그럼 총 500분이 걸릴 것으로 예상할 수 있다.)</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge"># 10일 간의 데이터</code></strong> 부분: <code class="language-plaintext highlighter-rouge">info_list</code>에 데이터를 추가하는 과정에서 억지로 포맷을 맞추기 위해 불필요한 <code class="language-plaintext highlighter-rouge">for문</code>이 들어갔다.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge"># D+1 종가 2% 상승 여부</code></strong> 부분: 전 날 대비 2% 상승율을 직접 계산해 주었는데, 이미 변화율이 계산 되어 있는 <code class="language-plaintext highlighter-rouge">change</code>라는 컬럼을 사용하는 것으로 대체한다.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">txt 파일 저장</code></strong>: <code class="language-plaintext highlighter-rouge">DataFrame</code>으로 생성을 한 후에 <code class="language-plaintext highlighter-rouge">txt</code> 파일로 저장했는데, 데이터 생성 시 파일 입출력 <code class="language-plaintext highlighter-rouge">write()</code>를 사용해서 바로 <code class="language-plaintext highlighter-rouge">txt</code> 파일로  저장하는 방식으로 변경한다.</p>
  </li>
</ul>

<hr />

<h2 id="️-1-finance-data-reader를-이용한-주가-데이터셋---df2list">✔️ (1) Finance Data Reader를 이용한 주가 데이터셋 - <code class="language-plaintext highlighter-rouge">df2list</code></h2>
<p>첫번째 방법은 <code class="language-plaintext highlighter-rouge">DataFrame</code> 사용을 지양하고, <code class="language-plaintext highlighter-rouge">python</code>의 기본 데이터 타입인 <code class="language-plaintext highlighter-rouge">list</code>로 바꾸어 사용하는 방법이다. 이로써 <code class="language-plaintext highlighter-rouge">column</code> 중심의 연산을 <code class="language-plaintext highlighter-rouge">row</code> 중심의 연산으로 바꾸어준다. 이 방법에서는 속도 개선 보다는 <code class="language-plaintext highlighter-rouge">(0)</code>번 방법의 코드에서 효율적이지 못했던 부분을 고치고 깔끔한 코드로 보완한다.</p>

<p><strong>과제 I</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># (0) 방법에서 사용했던 df_code 데이터 프레임 사용 
</span><span class="n">display</span><span class="p">(</span><span class="n">df_code</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># 🌟 dataframe -&gt; list 
</span><span class="n">lst_stock</span> <span class="o">=</span> <span class="n">df_code</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
<span class="k">print</span><span class="p">()</span>


<span class="n">lst_code</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># 선별 된 코드를 담을 리스트 
</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">lst_stock</span><span class="p">:</span>
    <span class="n">code</span><span class="p">,</span> <span class="n">date</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">date</span> <span class="o">&lt;=</span> <span class="s">'2018-01-01'</span><span class="p">:</span>
        <span class="n">lst_code</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"걸린 시간: "</span><span class="p">,</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
<span class="k">print</span><span class="p">()</span>

        
<span class="k">print</span><span class="p">(</span><span class="s">'상장일 2018-01-01 이전 종목코드: '</span><span class="p">,</span> <span class="n">lst_code</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
<span class="k">print</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'총 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_code</span><span class="p">)</span><span class="si">}</span><span class="s"> 개의 종목 중 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_code</span><span class="p">)</span><span class="si">}</span><span class="s"> 개의 종목 선별'</span><span class="p">)</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>회사명</th>
      <th>종목코드</th>
      <th>상장일</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>DL</td>
      <td>000210</td>
      <td>1976-02-02</td>
    </tr>
    <tr>
      <th>1</th>
      <td>DRB동일</td>
      <td>004840</td>
      <td>1976-05-21</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[['DL', '000210', '1976-02-02'], ['DRB동일', '004840', '1976-05-21']]

걸린 시간:  0.0004563331604003906

상장일 2018-01-01 이전 종목코드:  ['000210', '004840', '155660', '078930']

총 2536 개의 종목 중 1972 개의 종목 선별
</code></pre></div></div>

<p><strong>과제 II</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lst_code_date</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">lst_code</span><span class="p">):</span>
    <span class="n">stock</span> <span class="o">=</span> <span class="n">fdr</span><span class="p">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s">'20180102'</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">'20201231'</span><span class="p">)</span>
    <span class="n">stock</span><span class="p">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># 🌟 dataframe -&gt; list 
</span>    <span class="n">lst_stock</span> <span class="o">=</span> <span class="n">stock</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">tolist</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">lst_stock</span><span class="p">:</span> 
        <span class="n">date</span><span class="p">,</span> <span class="n">trading_value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">trading_value</span> <span class="o">&gt;=</span> <span class="mi">100000000000</span><span class="p">:</span>  <span class="c1"># 거래대금 1000억 이상
</span>            <span class="n">lst_code_date</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="n">code</span><span class="p">,</span> <span class="n">date</span><span class="p">.</span><span class="n">date</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y%m%d"</span><span class="p">)])</span>
            
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'선별된 날짜는 총 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_code_date</span><span class="p">)</span><span class="si">}</span><span class="s">개'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>100%|██████████████████████████████████████████████| 1977/1977 [02:55&lt;00:00, 11.26it/s]

선별된 날짜는 총 14182개
</code></pre></div></div>

<p><strong>과제 III</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">OF</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'assignment3.txt'</span><span class="p">,</span><span class="s">'w'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">lst_code_date</span><span class="p">):</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="s">'20180101'</span> 
    <span class="n">end_date</span> <span class="o">=</span> <span class="s">'20201231'</span> 
    <span class="n">stock</span> <span class="o">=</span> <span class="n">fdr</span><span class="p">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">end_date</span><span class="p">)</span>
    <span class="n">stock</span><span class="p">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># 'Date' index -&gt; column 
</span>    
    
    <span class="c1"># 🌟 dataframe -&gt; list 
</span>    <span class="n">lst_stock</span> <span class="o">=</span> <span class="n">stock</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">tolist</span><span class="p">()</span>
    
    
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">):</span> 
        <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="c1"># 예외 처리 
</span>            <span class="k">continue</span> 
        
        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">date</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y%m%d"</span><span class="p">)</span> <span class="o">==</span> <span class="n">date</span><span class="p">:</span> 
            
            <span class="c1"># D-9 ~ D0 데이터만 담기
</span>            <span class="n">sub_stock</span> <span class="o">=</span> <span class="n">lst_stock</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">9</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="c1"># 10일 간의 데이터 
</span>            <span class="n">lst_info</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">row2</span> <span class="ow">in</span> <span class="n">sub_stock</span><span class="p">:</span>
                <span class="n">lst_prices</span><span class="p">,</span> <span class="n">trading_value</span> <span class="o">=</span> <span class="n">row2</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                <span class="n">lst_info</span> <span class="o">+=</span> <span class="n">lst_prices</span> <span class="o">+</span> <span class="p">[</span><span class="n">trading_value</span><span class="p">]</span>
                
            <span class="n">info</span> <span class="o">=</span> <span class="s">','</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">lst_info</span><span class="p">))</span>
            
            <span class="c1"># D+1 종가 2% 상승 여부 (up)
</span>            <span class="n">change</span> <span class="o">=</span> <span class="n">lst_stock</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span>
            <span class="n">label</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">change</span> <span class="o">&gt;=</span> <span class="mf">0.02</span><span class="p">)</span>
            
            <span class="c1"># 저장 
</span>            <span class="n">OF</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">lst_info</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
            
<span class="n">OF</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'생성된 데이터의 개수는 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"assignment3.txt"</span><span class="p">))</span><span class="si">}</span><span class="s"> 개'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>100%|████████████████████████████████████████████| 14182/14182 [17:43&lt;00:00, 13.33it/s]

생성된 데이터의 개수는 13939 개
</code></pre></div></div>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">OF.write()</code>를 사용함으로써 블필요한 <code class="language-plaintext highlighter-rouge">DataFrame</code> 을 생성하지 않는다.</p>
  </li>
  <li>
    <p><strong># 10일간의 데이터</strong> 부분은 <code class="language-plaintext highlighter-rouge">join()</code> 함수를 사용하여 불필요한 for문 사용을 줄였고, <strong># D+1 종가 2% 상승 여부 (up)</strong> 부분은 전날 대비 종가 변화율을 계산하지 않고 <code class="language-plaintext highlighter-rouge">change</code> 컬럼을 활용하는 것으로 바꾸었다.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">속도에 대한 문제점</code></strong> : 전 보다 깔끔한 코드로 보완이 되었지만, 아직 속도에 대한 문제점이 남아있다. 속도를 개선하기 위해서는 <code class="language-plaintext highlighter-rouge">fdr</code> 라이브러리를 최소한으로 사용해야 한다. 이를 해결하기 위해 <code class="language-plaintext highlighter-rouge">dictionary</code>를 사용하는 방법으로 넘어간다.</p>
  </li>
</ul>

<hr />

<h2 id="️-2-finance-data-reader를-이용한-주가-데이터셋---dictionary">✔️ (2) Finance Data Reader를 이용한 주가 데이터셋 - <code class="language-plaintext highlighter-rouge">dictionary</code></h2>

<p><code class="language-plaintext highlighter-rouge">dictionary</code>를 사용하는 방법은 <strong><code class="language-plaintext highlighter-rouge">과제III</code></strong> 의 속도를 개선한다. <code class="language-plaintext highlighter-rouge">fdr</code> 라이브러리를 최소한으로 사용하고, <code class="language-plaintext highlighter-rouge">for</code>문을 최대한 줄인다. 현재 문제점은 날짜를 기준으로 <code class="language-plaintext highlighter-rouge">for</code>문이 돌아가기 때문에 같은 데이터(같은 종목)가 여러번 불러와지는 경우가 다수 존재한다는 것이다. 따라서 <strong><code class="language-plaintext highlighter-rouge">과제II</code></strong> 에서 <code class="language-plaintext highlighter-rouge">code</code>별 <code class="language-plaintext highlighter-rouge">D0</code> 날짜 리스트를 <code class="language-plaintext highlighter-rouge">dictionary</code> 타입으로 생성하고, <strong><code class="language-plaintext highlighter-rouge">과제III</code></strong> 에서 <code class="language-plaintext highlighter-rouge">code</code> 당 한번만 <code class="language-plaintext highlighter-rouge">fdr</code> 라이브러리를 사용하도록 바꾸어 준다.</p>

<p><strong>과제 I</strong></p>

<p><strong><code class="language-plaintext highlighter-rouge">과제I</code></strong> 은 앞의 방법과 같으므로 생략한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">'상장일 2018-01-01 이전 종목코드: '</span><span class="p">,</span> <span class="n">lst_code</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
<span class="k">print</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'총 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_code</span><span class="p">)</span><span class="si">}</span><span class="s"> 개의 종목 중 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_code</span><span class="p">)</span><span class="si">}</span><span class="s"> 개의 종목 선별'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>상장일 2018-01-01 이전 종목코드:  ['000210', '004840', '155660', '078930']

총 2507 개의 종목 중 1977 개의 종목 선별
</code></pre></div></div>

<p><strong>과제 II</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dict_code2date</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">lst_code</span><span class="p">):</span> 
    <span class="n">start_date</span> <span class="o">=</span> <span class="s">'20180102'</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="s">'20201231'</span>
    <span class="n">stock</span> <span class="o">=</span> <span class="n">fdr</span><span class="p">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">end_date</span><span class="p">)</span>
    <span class="n">stock</span><span class="p">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>    
    
    <span class="c1"># 🌟 dataframe -&gt; list     
</span>    <span class="n">lst_stock</span> <span class="o">=</span> <span class="n">stock</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">tolist</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">lst_stock</span><span class="p">:</span> 
        <span class="n">date</span><span class="p">,</span> <span class="n">trading_value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">trading_value</span> <span class="o">&gt;=</span> <span class="mi">100000000000</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dict_code2date</span><span class="p">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">dict_code2date</span><span class="p">[</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">date</span><span class="p">.</span><span class="n">date</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y%m%d"</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dict_code2date</span><span class="p">[</span><span class="n">code</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">.</span><span class="n">date</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y%m%d"</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'총 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_code</span><span class="p">)</span><span class="si">}</span><span class="s"> 개의 종목 중 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dict_code2date</span><span class="p">)</span><span class="si">}</span><span class="s"> 개의 종목 사용'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>100%|██████████████████████████████████████████████| 1977/1977 [02:42&lt;00:00, 12.14it/s]

총 1977 개의 종목 중 799 개의 종목 사용
</code></pre></div></div>

<p><strong>과제 III</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">OF</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'assignment3.txt'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">dict_code2date</span><span class="p">):</span> 
    <span class="c1"># code의 stock 
</span>    <span class="n">start_date</span> <span class="o">=</span> <span class="s">'20180101'</span> 
    <span class="n">end_date</span> <span class="o">=</span> <span class="s">'20201231'</span> 
    <span class="n">stock</span> <span class="o">=</span> <span class="n">fdr</span><span class="p">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">end_date</span><span class="p">)</span>
    <span class="n">stock</span><span class="p">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># 🌟 dataframe -&gt; list     
</span>    <span class="n">lst_stock</span> <span class="o">=</span> <span class="n">stock</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">tolist</span><span class="p">()</span>  
       
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">):</span>   
        <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="c1"># 예외 처리 
</span>            <span class="k">continue</span> 
        
        <span class="n">date</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">date</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y%m%d"</span><span class="p">)</span> 
        <span class="k">if</span> <span class="n">date</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dict_code2date</span><span class="p">[</span><span class="n">code</span><span class="p">]:</span> <span class="c1"># 조건에 부합하는 날짜 (D0 날짜)를 발견할 때까지 continue
</span>            <span class="k">continue</span> 

        <span class="c1"># D-9 ~ D0 데이터만 담기
</span>        <span class="n">sub_stock</span> <span class="o">=</span> <span class="n">lst_stock</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">9</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> 
        
        <span class="c1"># 10일간의 데이터 
</span>        <span class="n">lst_info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row2</span> <span class="ow">in</span> <span class="n">sub_stock</span><span class="p">:</span>
            <span class="n">lst_prices</span><span class="p">,</span> <span class="n">trading_value</span> <span class="o">=</span> <span class="n">row2</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span> <span class="n">row2</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">row2</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">lst_info</span> <span class="o">+=</span> <span class="n">lst_prices</span> <span class="o">+</span> <span class="p">[</span><span class="n">trading_value</span><span class="p">]</span>
        <span class="n">info</span> <span class="o">=</span> <span class="s">','</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">lst_info</span><span class="p">))</span>

        <span class="c1"># D+1 종가 2% 상승 여부 
</span>        <span class="n">label</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.02</span><span class="p">)</span>

        <span class="c1"># 저장 
</span>        <span class="n">OF</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
                         
<span class="n">OF</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>   

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'생성된 데이터의 개수는 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"assignment3.txt"</span><span class="p">))</span><span class="si">}</span><span class="s"> 개'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>100%|████████████████████████████████████████████████| 799/799 [01:07&lt;00:00, 11.84it/s]

생성된 데이터의 개수는 13939 개
</code></pre></div></div>

<p>약 17분이 걸리던 시간이 1분으로 줄어들었다.</p>

<hr />

<h2 id="️-3-finance-data-reader를-이용한-주가-데이터셋---multiprocessing">✔️ (3) Finance Data Reader를 이용한 주가 데이터셋 - <code class="language-plaintext highlighter-rouge">MultiProcessing</code></h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">multi processing(다중 처리)</code>: 컴퓨터 시스템 한 대에 두개 이상의 중앙 처리 장치 (CPU) 를 이용하여 병렬처리하는 것</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">python multi processing</code> 문서: <a href="https://docs.python.org/ko/3/library/multiprocessing.html">https://docs.python.org/ko/3/library/multiprocessing.html</a>.</p>
  </li>
</ul>

<p><code class="language-plaintext highlighter-rouge">python</code>은 <code class="language-plaintext highlighter-rouge">multiprocessing</code> 라이브러리를 통해 다중 처리를 지원한다. 여러 개의 <code class="language-plaintext highlighter-rouge">코어</code>를 연산에 사용함으로써 많은 작업을 빠른 시간에 처리해줄 수 있다는 장점이 있다.</p>

<p><img src="/myblog/images/multi_processing.png" alt="" /><br />
[ <code class="language-plaintext highlighter-rouge">core=10</code>으로 설정하여 multi processing을 수행할 때 코어 사용 ]</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># MultiProcessing을 위한 library import 
</span><span class="kn">import</span> <span class="nn">time</span><span class="p">,</span> <span class="n">os</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
</code></pre></div></div>

<p><strong>과제 I</strong></p>

<p><strong><code class="language-plaintext highlighter-rouge">과제I</code></strong> 은 앞의 방법과 같으므로 생략한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">'상장일 2018-01-01 이전 종목코드: '</span><span class="p">,</span> <span class="n">lst_code</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
<span class="k">print</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'총 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_code</span><span class="p">)</span><span class="si">}</span><span class="s"> 개의 종목 중 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_code</span><span class="p">)</span><span class="si">}</span><span class="s"> 개의 종목 선별'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>상장일 2018-01-01 이전 종목코드:  ['000210', '004840', '155660', '078930']

총 2507 개의 종목 중 1977 개의 종목 선별
</code></pre></div></div>

<p><strong>과제 II</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">multi processing</code>을 위한 함수 정의</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">make_lst_result</span><span class="p">(</span><span class="n">code</span><span class="p">):</span> 
    <span class="n">start_date</span> <span class="o">=</span> <span class="s">'20180101'</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="s">'20201231'</span>
    
    <span class="n">lst_date</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="n">stock</span> <span class="o">=</span> <span class="n">fdr</span><span class="p">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">end_date</span><span class="p">)</span>
    <span class="n">stock</span><span class="p">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  
    <span class="c1"># 🌟 dataframe -&gt; list
</span>    <span class="n">lst_stock</span> <span class="o">=</span> <span class="n">stock</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">tolist</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">lst_stock</span><span class="p">:</span> 
        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">100000000000</span><span class="p">:</span> 
            <span class="n">lst_date</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">date</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y%m%d"</span><span class="p">))</span>
        
    <span class="k">return</span> <span class="p">[</span><span class="n">code</span><span class="p">,</span> <span class="n">lst_date</span><span class="p">]</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">multi processing</code> 수행</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">num_cores</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">num_cores</span><span class="p">)</span>
<span class="n">lst_code_date</span> <span class="o">=</span> <span class="n">pool</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="n">make_lst_result</span><span class="p">,</span> <span class="n">lst_code</span><span class="p">)</span>
<span class="n">pool</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">pool</span><span class="p">.</span><span class="n">join</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>17.97966194152832
</code></pre></div></div>

<p>앞서 약 2분 40초 가 걸렸던 <strong><code class="language-plaintext highlighter-rouge">과제II</code></strong> 를 <code class="language-plaintext highlighter-rouge">multi processing</code>을 사용하여 17초대로 단축시켰다.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">dictionary</code> 생성</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dict_code2date</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">lst_date</span>  <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">lst_code_date</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">lst_date</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="k">continue</span>
    <span class="n">dict_code2date</span><span class="p">[</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">lst_date</span>
            
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'총 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_code</span><span class="p">)</span><span class="si">}</span><span class="s"> 개의 종목 중 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dict_code2date</span><span class="p">)</span><span class="si">}</span><span class="s"> 개의 종목 사용'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>100%|█████████████████████████████████████████| 1977/1977 [00:00&lt;00:00, 1610124.08it/s]

총 1977 개의 종목 중 799 개의 종목 사용
</code></pre></div></div>

<p><strong>과제 III</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">multi processing</code>을 위한 함수 정의</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">make_lst_result2</span><span class="p">(</span><span class="n">code</span><span class="p">):</span> 
    <span class="c1"># code의 stock 
</span>    <span class="n">start_date</span> <span class="o">=</span> <span class="s">'20180101'</span> 
    <span class="n">end_date</span> <span class="o">=</span> <span class="s">'20201231'</span> 
    <span class="n">stock</span> <span class="o">=</span> <span class="n">fdr</span><span class="p">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">end_date</span><span class="p">)</span>
    <span class="n">stock</span><span class="p">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># 🌟 dataframe -&gt; list     
</span>    <span class="n">lst_stock</span> <span class="o">=</span> <span class="n">stock</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">tolist</span><span class="p">()</span>  
       
    <span class="n">lst_result</span> <span class="o">=</span> <span class="p">[]</span>
        
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">):</span> 
        
        <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="c1"># 예외 처리 
</span>            <span class="k">continue</span> 
            
        <span class="n">date</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">date</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y%m%d"</span><span class="p">)</span> 
        <span class="k">if</span> <span class="n">date</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dict_code2date</span><span class="p">[</span><span class="n">code</span><span class="p">]:</span> <span class="c1"># 조건에 부합하는 날짜 (D0 날짜)를 발견할 때까지 continue
</span>            <span class="k">continue</span> 

        <span class="c1"># D-9 ~ D0 데이터만 담기
</span>        <span class="n">sub_stock</span> <span class="o">=</span> <span class="n">lst_stock</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">9</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> 
        
        <span class="c1"># 10일간의 데이터 
</span>        <span class="n">lst_info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row2</span> <span class="ow">in</span> <span class="n">sub_stock</span><span class="p">:</span>
            <span class="n">lst_prices</span><span class="p">,</span> <span class="n">trading_value</span> <span class="o">=</span> <span class="n">row2</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span> <span class="n">row2</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">row2</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">lst_info</span> <span class="o">+=</span> <span class="n">lst_prices</span> <span class="o">+</span> <span class="p">[</span><span class="n">trading_value</span><span class="p">]</span>
        <span class="n">info</span> <span class="o">=</span> <span class="s">','</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">lst_info</span><span class="p">))</span>

        <span class="c1"># D+1 종가 2% 상승 여부 
</span>        <span class="n">label</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.02</span><span class="p">)</span>
        
        <span class="n">lst_result</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="n">code</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">label</span><span class="p">])</span>
        
    <span class="k">return</span> <span class="n">lst_result</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">multi processing</code> 수행</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">num_cores</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">num_cores</span><span class="p">)</span>
<span class="n">lst_data</span> <span class="o">=</span> <span class="n">pool</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="n">make_lst_result2</span><span class="p">,</span> <span class="n">dict_code2date</span><span class="p">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">pool</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">pool</span><span class="p">.</span><span class="n">join</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>8.186521768569946
</code></pre></div></div>

<p>앞서 진행했던 방법에서 1분이 걸렸던 작업이 <code class="language-plaintext highlighter-rouge">multi processing</code>을 통하여 8초로 줄어들었다.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">txt</code> 파일 생성</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">OF</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"assignment3_multi_processing.txt"</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">lst_data</span><span class="p">:</span> 
    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)):</span> 
        <span class="n">OF</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">'</span><span class="se">\t</span><span class="s">'</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="n">num</span><span class="p">]))</span> <span class="o">+</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
        
<span class="n">OF</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'생성된 데이터의 개수는 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"assignment3_multi_processing.txt"</span><span class="p">))</span><span class="si">}</span><span class="s"> 개'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>생성된 데이터의 개수는 13939 개
</code></pre></div></div>

<hr />

<h3 id="️-4-finance-data-reader를-이용한-주가-데이터셋---mysql">✔️ <strong>(4)</strong> Finance Data Reader를 이용한 주가 데이터셋 - <code class="language-plaintext highlighter-rouge">MySQL</code></h3>

<p>4번째 방법은 <code class="language-plaintext highlighter-rouge">MySQL</code>을 사용한다. 외부 데이터를 불러오지 않아도 되고, 서버 <code class="language-plaintext highlighter-rouge">DB</code>에 저장된 데이터를 불러오는 것이므로 <code class="language-plaintext highlighter-rouge">multi processing</code>을 사용하지 않고도 빠른 속도로 데이터셋을 생성할 수 있다.</p>

<p><strong>과제 I</strong></p>

<p>최종적으로 머신러닝 분석에 사용할 데이터셋은 코스피, 코스닥 시장에 해당하는 종목들만을 사용한다. 현재 <code class="language-plaintext highlighter-rouge">db</code>에 저장되어 있는 데이터도 코스피, 코스닥 시장에 해당하는 종목들이 입력되어 있으며, 해당 종목들을 추린 <code class="language-plaintext highlighter-rouge">code_list.txt</code>에서 종목들을 불러와 <code class="language-plaintext highlighter-rouge">lst_code</code>를 사용한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">IF</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'../data/code_list.txt'</span><span class="p">)</span>
<span class="n">lst_code</span> <span class="o">=</span> <span class="n">IF</span><span class="p">.</span><span class="n">readlines</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'총 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_code</span><span class="p">)</span><span class="si">}</span><span class="s"> 개의 종목 중 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_code</span><span class="p">)</span><span class="si">}</span><span class="s"> 개의 종목 선별'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>총 2536 개의 종목 중 1561 개의 종목 선별
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pymysql 설치
# ! pip install pymysql
</span>
<span class="kn">import</span> <span class="nn">pymysql</span> 
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
</code></pre></div></div>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">MySQL</code> 데이터 저장</strong> (<code class="language-plaintext highlighter-rouge">dataframe</code> -&gt; <code class="language-plaintext highlighter-rouge">sql</code>) <br /></li>
</ul>

<p><code class="language-plaintext highlighter-rouge">code</code> 별로 다른 테이블에 저장한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db_connection_str</span> <span class="o">=</span> <span class="s">'mysql+pymysql://[db username]:[db password]@[host address]/[db name]'</span> 
<span class="n">db_connection</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">db_connection_str</span><span class="p">)</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">db_connection</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>

<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">lst_code</span><span class="p">):</span> 
    <span class="n">start_date</span> <span class="o">=</span> <span class="s">'20170101'</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="s">'20211231'</span>
    <span class="n">stock</span> <span class="o">=</span> <span class="n">fdr</span><span class="p">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">end_date</span><span class="p">)</span>
    <span class="n">stock</span> <span class="o">=</span> <span class="n">stock</span><span class="p">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">stock</span> <span class="o">=</span> <span class="n">stock</span><span class="p">[[</span><span class="s">'Date'</span><span class="p">,</span> <span class="s">'Open'</span><span class="p">,</span> <span class="s">'High'</span><span class="p">,</span> <span class="s">'Low'</span><span class="p">,</span> <span class="s">'Close'</span><span class="p">,</span> <span class="s">'Volume'</span><span class="p">,</span> <span class="s">'Change'</span><span class="p">]]</span>
    <span class="n">stock</span><span class="p">.</span><span class="n">to_sql</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s">'stock_</span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s">'</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">db_connection</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s">'fail'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">MySQL</code> 에서 데이터 불러온 후 데이터셋 생성</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db_dsml</span> <span class="o">=</span> <span class="n">pymysql</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">host</span> <span class="o">=</span> <span class="s">'localhost'</span><span class="p">,</span> 
    <span class="n">port</span> <span class="o">=</span> <span class="mi">3306</span><span class="p">,</span> 
    <span class="n">user</span> <span class="o">=</span> <span class="s">'[db username]'</span><span class="p">,</span> 
    <span class="n">passwd</span> <span class="o">=</span> <span class="s">'[db password]'</span><span class="p">,</span> 
    <span class="n">db</span> <span class="o">=</span> <span class="s">'[db name]'</span><span class="p">,</span> 
    <span class="n">charset</span> <span class="o">=</span> <span class="s">'utf8'</span>
<span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">db_dsml</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
</code></pre></div></div>

<p><strong>과제 II</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dict_code2date</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">lst_code</span><span class="p">):</span> 
    <span class="n">code</span> <span class="o">=</span> <span class="n">code</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">sql_query</span> <span class="o">=</span> <span class="s">'''
                SELECT *
                FROM stock_{}
                WHERE Date BETWEEN '2018-01-01' AND '2020-12-31'
                '''</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="n">stock</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sql</span> <span class="o">=</span> <span class="n">sql_query</span><span class="p">,</span> <span class="n">con</span> <span class="o">=</span> <span class="n">db_dsml</span><span class="p">)</span>   
    
    <span class="c1"># 🌟 dataframe -&gt; list     
</span>    <span class="n">lst_stock</span> <span class="o">=</span> <span class="n">stock</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">tolist</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">lst_stock</span><span class="p">:</span> 
        <span class="n">date</span><span class="p">,</span> <span class="n">trading_value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">trading_value</span> <span class="o">&gt;=</span> <span class="mi">100000000000</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dict_code2date</span><span class="p">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">dict_code2date</span><span class="p">[</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">date</span><span class="p">.</span><span class="n">date</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y%m%d"</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dict_code2date</span><span class="p">[</span><span class="n">code</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">.</span><span class="n">date</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y%m%d"</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'총 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_code</span><span class="p">)</span><span class="si">}</span><span class="s"> 개의 종목 중 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dict_code2date</span><span class="p">)</span><span class="si">}</span><span class="s"> 개의 종목 사용'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████| 1561/1561 [00:18&lt;00:00, 82.67it/s]

총 1561 개의 종목 중 679 개의 종목 사용
</code></pre></div></div>

<p><strong>과제 III</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">OF</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'assignment3_sql.txt'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">dict_code2date</span><span class="p">):</span> 
    <span class="n">code</span> <span class="o">=</span> <span class="n">code</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">sql_query</span> <span class="o">=</span> <span class="s">'''
                SELECT *
                FROM stock_{}
                WHERE Date BETWEEN '2018-01-01' AND '2020-12-31'
                '''</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="n">stock</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sql</span> <span class="o">=</span> <span class="n">sql_query</span><span class="p">,</span> <span class="n">con</span> <span class="o">=</span> <span class="n">db_dsml</span><span class="p">)</span>  
    
    <span class="c1"># 🌟 dataframe -&gt; list     
</span>    <span class="n">lst_stock</span> <span class="o">=</span> <span class="n">stock</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">tolist</span><span class="p">()</span>  
       
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">):</span>   
        <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="c1"># 예외 처리 
</span>            <span class="k">continue</span> 
        
        <span class="n">date</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">date</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y%m%d"</span><span class="p">)</span> 
        <span class="k">if</span> <span class="n">date</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dict_code2date</span><span class="p">[</span><span class="n">code</span><span class="p">]:</span> <span class="c1"># 조건에 부합하는 날짜 (D0 날짜)를 발견할 때까지 continue
</span>            <span class="k">continue</span> 

        <span class="c1"># D-9 ~ D0 데이터만 담기
</span>        <span class="n">sub_stock</span> <span class="o">=</span> <span class="n">lst_stock</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">9</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> 
        
        <span class="c1"># 10일간의 데이터 
</span>        <span class="n">lst_info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row2</span> <span class="ow">in</span> <span class="n">sub_stock</span><span class="p">:</span>
            <span class="n">lst_prices</span><span class="p">,</span> <span class="n">trading_value</span> <span class="o">=</span> <span class="n">row2</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span> <span class="n">row2</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">row2</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">lst_info</span> <span class="o">+=</span> <span class="n">lst_prices</span> <span class="o">+</span> <span class="p">[</span><span class="n">trading_value</span><span class="p">]</span>
        <span class="n">info</span> <span class="o">=</span> <span class="s">','</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">lst_info</span><span class="p">))</span>

        <span class="c1"># D+1 종가 2% 상승 여부 
</span>        <span class="n">label</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lst_stock</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.02</span><span class="p">)</span>

        <span class="c1"># 저장 
</span>        <span class="n">OF</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
                         
        <span class="k">return</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">OF</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>   

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'생성된 데이터의 개수는 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"assignment3_sql.txt"</span><span class="p">))</span><span class="si">}</span><span class="s"> 개'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████| 679/679 [00:09&lt;00:00, 72.67it/s]


생성된 데이터의 개수는 11934 개
</code></pre></div></div>

<hr />

<h3 id="️-5-최종-머신러닝-데이터셋">✔️ <strong>(5)</strong> 최종 머신러닝 데이터셋</h3>
<p>최종적으로 생성된 머신러닝 데이터셋의 형태를 확인한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">IF</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s">"assignment3_sql.txt"</span><span class="p">,</span><span class="s">'r'</span><span class="p">)</span>
<span class="n">lst_code_date</span><span class="o">=</span><span class="p">[]</span>
<span class="n">trainX</span><span class="o">=</span><span class="p">[]</span>
<span class="n">trainY</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">IF</span><span class="p">:</span>
    <span class="n">code</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">strip</span><span class="p">().</span><span class="n">split</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">)</span>
    <span class="n">lst_code_date</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="n">code</span><span class="p">,</span> <span class="n">date</span><span class="p">])</span>
    <span class="n">trainX</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">x</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">))))</span>
    <span class="n">trainY</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
<span class="n">trainX</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">trainX</span><span class="p">)</span>
<span class="n">trainY</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">trainY</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">"===== trainX ====="</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"trainX shape:"</span><span class="p">,</span> <span class="n">trainX</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">trainX</span><span class="p">.</span><span class="n">head</span><span class="p">())</span>
<span class="k">print</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">"===== trainY ====="</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"trainY shape:"</span><span class="p">,</span> <span class="n">trainY</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">trainY</span><span class="p">.</span><span class="n">head</span><span class="p">())</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>===== trainX =====
trainX shape: (11935, 50)
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>40</th>
      <th>41</th>
      <th>42</th>
      <th>43</th>
      <th>44</th>
      <th>45</th>
      <th>46</th>
      <th>47</th>
      <th>48</th>
      <th>49</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10250</td>
      <td>12050</td>
      <td>10150</td>
      <td>11800</td>
      <td>307823874200</td>
      <td>11950</td>
      <td>12450</td>
      <td>10900</td>
      <td>11750</td>
      <td>240410569500</td>
      <td>...</td>
      <td>15300</td>
      <td>15400</td>
      <td>12650</td>
      <td>13700</td>
      <td>789063638200</td>
      <td>13700</td>
      <td>16100</td>
      <td>13400</td>
      <td>15400</td>
      <td>897154258000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>11950</td>
      <td>12450</td>
      <td>10900</td>
      <td>11750</td>
      <td>240410569500</td>
      <td>11850</td>
      <td>14150</td>
      <td>11600</td>
      <td>12600</td>
      <td>764364560400</td>
      <td>...</td>
      <td>13700</td>
      <td>16100</td>
      <td>13400</td>
      <td>15400</td>
      <td>897154258000</td>
      <td>14700</td>
      <td>15500</td>
      <td>14000</td>
      <td>14350</td>
      <td>277027065700</td>
    </tr>
    <tr>
      <th>2</th>
      <td>11850</td>
      <td>14150</td>
      <td>11600</td>
      <td>12600</td>
      <td>764364560400</td>
      <td>12800</td>
      <td>13200</td>
      <td>12000</td>
      <td>12200</td>
      <td>170010147600</td>
      <td>...</td>
      <td>14700</td>
      <td>15500</td>
      <td>14000</td>
      <td>14350</td>
      <td>277027065700</td>
      <td>13050</td>
      <td>13300</td>
      <td>11650</td>
      <td>11650</td>
      <td>231873876050</td>
    </tr>
    <tr>
      <th>3</th>
      <td>12800</td>
      <td>13200</td>
      <td>12000</td>
      <td>12200</td>
      <td>170010147600</td>
      <td>12450</td>
      <td>13400</td>
      <td>12350</td>
      <td>12850</td>
      <td>211661434950</td>
      <td>...</td>
      <td>13050</td>
      <td>13300</td>
      <td>11650</td>
      <td>11650</td>
      <td>231873876050</td>
      <td>12200</td>
      <td>13150</td>
      <td>11600</td>
      <td>12200</td>
      <td>222393934200</td>
    </tr>
    <tr>
      <th>4</th>
      <td>12450</td>
      <td>13400</td>
      <td>12350</td>
      <td>12850</td>
      <td>211661434950</td>
      <td>12800</td>
      <td>12950</td>
      <td>11300</td>
      <td>11700</td>
      <td>91801277100</td>
      <td>...</td>
      <td>12200</td>
      <td>13150</td>
      <td>11600</td>
      <td>12200</td>
      <td>222393934200</td>
      <td>12200</td>
      <td>13750</td>
      <td>12100</td>
      <td>12350</td>
      <td>256196958550</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 50 columns</p>
</div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>===== trainY =====
trainY shape: (11935, 1)
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>

<hr />

<p>4단계의 과정을 거쳐 머신러닝 데이터셋 생성을 마쳤다. 다음 글에서는 생성된 머신러닝 데이터셋을 사용하여 여러 머신러닝 모델을 학습 및 평가하여 성능이 가장 좋은 모델을 선정하는 <code class="language-plaintext highlighter-rouge">baseline model selection</code>을 진행한다.</p>

      <div class="c-article__footer u-clearfix">
        <div class="c-article__tag">
          
        </div>
        <div class="c-article__share">
          <a href="https://twitter.com/intent/tweet?text=Stock%20Research%20%7C%7C%201.1.%20%EB%A8%B8%EC%8B%A0%EB%9F%AC%EB%8B%9D%EC%9D%84%20%EC%9C%84%ED%95%9C%20%EC%A3%BC%EA%B0%80%20%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%85%8B%20%EC%83%9D%EC%84%B1&url=https://ag-su.github.io/2022/07/06/stock-dataset/" title="Share
          on Twitter" rel="nofollow" target="_blank"><div data-icon='ei-sc-twitter' data-size='s'></div></a>
          <a href="https://facebook.com/sharer.php?u=https://ag-su.github.io/2022/07/06/stock-dataset/" title="Share on Facebook" rel="nofollow" target="_blank"><div data-icon='ei-sc-facebook' data-size='s'></div></a>
          <a href="https://plus.google.com/share?url=https://ag-su.github.io/2022/07/06/stock-dataset/" title="Share on Google+" rel="nofollow" target="_blank"><div data-icon='ei-sc-google-plus' data-size='s'></div></a>
        </div>
      </div>
      <div class="c-newsletter">
  <div class="c-newsletter__header">
    <h4 class="c-newsletter__title">Newsletter</h4>
    <div class="c-newsletter__subtitle">Subscribe to this blog and receive notifications of new posts by email.</div>
  </div>
  <form class="c-newsletter-form validate" action="#" method="POST" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate>
    <div class="c-newsletter-form__group">
      <label class="u-screen-reader-text" for="mce-EMAIL">Email address</label>
      <input class="c-newsletter__email required email" id="mce-EMAIL" type="email" name="EMAIL" placeholder="Your email address" autocomplete="on">
      <input class="c-newsletter__button" id="mc-embedded-subscribe" type="submit" name="subscribe" value="Subscribe">
    </div>
  </form>
</div> <!-- /.c-newsletter -->
      <div class="c-recent-post">
        <h4 class="c-recent__title">You might also enjoy</h4>
        <div class="c-recent__box">
        
        
          <div class="c-recent__item">
            <a class="c-recent__image" href="/2022/10/19/credit-card-fraud-detection/" style="background-image: url( /myblog/images/01.credit_thumbnail.png)"></a>
            <div class="c-recent__footer">
              <h4><a href="/2022/10/19/credit-card-fraud-detection/">Transcription || [Kaggle] Credit card Fraud Detection</a></h4>
              <div class="c-recent__date">
                <time datetime="2022-10-19T00:00:00+09:00">October 19, 2022</time>
              </div>
            </div>
          </div>
        
        
        
          <div class="c-recent__item">
            <a class="c-recent__image" href="/2022/07/25/cluster-filtering/" style="background-image: url( /myblog/images/08.thumbnail.png)"></a>
            <div class="c-recent__footer">
              <h4><a href="/2022/07/25/cluster-filtering/">Stock Research || 3.3. 클러스터링 분석을 통한 주가 상승추세 패턴 검출</a></h4>
              <div class="c-recent__date">
                <time datetime="2022-07-25T00:00:00+09:00">July 25, 2022</time>
              </div>
            </div>
          </div>
        
        
        
          <div class="c-recent__item">
            <a class="c-recent__image" href="/2022/07/22/tsne/" style="background-image: url( /myblog/images/07.thumbnail.png)"></a>
            <div class="c-recent__footer">
              <h4><a href="/2022/07/22/tsne/">Stock Research || 3.2. t-SNE를 사용한 주가데이터 2차원 시각화</a></h4>
              <div class="c-recent__date">
                <time datetime="2022-07-22T00:00:00+09:00">July 22, 2022</time>
              </div>
            </div>
          </div>
        
        
        
          <div class="c-recent__item">
            <a class="c-recent__image" href="/2022/07/18/shap-value/" style="background-image: url( /myblog/images/06.thumbnail.png)"></a>
            <div class="c-recent__footer">
              <h4><a href="/2022/07/18/shap-value/">Stock Research || 3.1. 설명가능 AI (XAI), SHAP value</a></h4>
              <div class="c-recent__date">
                <time datetime="2022-07-18T00:00:00+09:00">July 18, 2022</time>
              </div>
            </div>
          </div>
        
        
        </div>
      </div> <!-- /.c-recent-post -->
      
        <div class="c-comments">
  <div id="disqus_thread" class="article-comments"></div>
  <script>
    (function () {
      var d = document, s = d.createElement('script');
      s.src = '//mr-brown.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
</div> <!-- /.c-comments -->
      
    </div> <!-- /.c-wrap-content -->
  </div> <!-- /.c-article__content -->
</article> <!-- /.c-article-page -->

</main> <!-- /.c-content -->
  </div> <!-- /.o-wrapper -->
  <div class="c-top" data-icon='ei-chevron-up' data-size='s' title="Scroll To Top"></div> <!-- /.c-top -->
  <script src="/myblog/js/jquery-3.3.1.min.js"></script>
<script src="/myblog/js/evil-icons.min.js"></script>
<script src="/myblog/js/jquery.fitvids.js"></script>
<script src="/myblog/js/simple-jekyll-search.min.js"></script>
<script src="/myblog/js/main.js"></script>
<!-- /javascripts -->
</body>
</html>